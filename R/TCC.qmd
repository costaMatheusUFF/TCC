---
title: "Análise da aplicação da moderna teoriade portfólio de markowitz sobre o mercado das criptomoedas"
author: "Matheus Pereira Costa"
date: "`r Sys.Date()`"
format: 
  # html:
  #   toc: true
  #   toc-depth: 3
  #   number-sections: true
  # pdf:
  #   toc: true
  #   toc-depth: 3
  #   number-sections: true
  #   link-citations: true
  #   link-bibliography: true
  #   lot: true
  #   lof: true
  #   output-file: "TCC"
  #   output-ext: "pdf"
  docx:
    toc: true
    toc-depth: 3
    number-sections: true
    number-depth: 3
    link-citations: true
    link-bibliography: true
    reference-doc: ModeloTCC8.dotx
    output-file: "TCC"
    output-ext: "docx"
editor: visual
lang: pt
bibliography: references.bib
execute: 
  echo: false
  warning: false
---

```{r}
#| label: start

library(tidyverse)
library(quantmod)
library(scales)
library(PerformanceAnalytics)
library(openxlsx)
library(corrplot)
library(RColorBrewer)
library(knitr)
source("functions/allFunctions.R")
source("variaveis.R")


dataInicio = dmyFormat(from)
dataFim = dmyFormat(to)
figWidth = 5.7
figHeight = 4

## codigo

asset_return = getPrices(folder,symbols,from,to)

dataPortfolio = dmyFormat(first(index(asset_return))) 

covariance_cryptocurrency = cov(asset_return)
correlation_cryptocurrency = cor(asset_return)

asset_return_long = returnToLong(asset_return,symbols)

summary_asset_long = asset_return_long %>% 
  group_by(asset) %>% 
  summarise(sd=sd(returns),mean=mean(returns))

less_riskier = slice_min(summary_asset_long,sd)
more_proftible = slice_max(summary_asset_long,mean)

# portfolio igual

w = 1/Nsymbols %>% rep(Nsymbols)

portfolio_return = Return.portfolio(asset_return,weights = w,rebalance_on = "months")
sd_portfolio = sd(portfolio_return$portfolio.returns)
mean_portfolio = mean(portfolio_return$portfolio.returns)
sr_portfolio = SharpeRatio(portfolio_return,Rf=rfr,FUN = "StdDev")

# portfolio optimizado

possibilities = loadPossibilites(filePossibilites,fullPathPossibilites,symbols,by)

min_var <- slice_min(possibilities,sd)
max_sr <- slice_max(possibilities,sharpeRatePortfolio)
max_re <- slice_max(possibilities,sharpeRatePortfolio)


bestCombination = slice_max(possibilities,sharpeRatePortfolio)
summaryBestCombination = bestCombination[which(bestCombination[1:Nsymbols] > 0)]
safetyCombination = slice_min(possibilities,sd)
summarysafetyCombination = safetyCombination[which(safetyCombination[1:Nsymbols] > 0)]


w = max_sr[1:Nsymbols] %>% unlist()

portfolio_return_opmitized = Return.portfolio(asset_return,
                                              weights = w,
                                              rebalance_on = "months")

sd_portfolio_optimized = sd(portfolio_return_opmitized$portfolio.returns)
mean_portfolio_optimized = mean(portfolio_return_opmitized$portfolio.returns)
sr_portfolio_optimized = max_sr$sharpeRatePortfolio


### limitando o eixo Y

yMax = max(c(portfolio_return$portfolio.returns, portfolio_return_opmitized$portfolio.returns)) 
yMin = min(c(portfolio_return$portfolio.returns, portfolio_return_opmitized$portfolio.returns)) 


### grafico retorno portfolios


portfolio_plot = portfolio_return %>% 
  to.monthly(OHLC=F,indexAt = "lastof") %>%
  as.data.frame(row.names = index(.)) %>%
  rownames_to_column("date") %>%
  rename("returns"=portfolio.returns) %>%
  mutate(date = as.Date(date),
         color = case_when(
           returns < mean_portfolio - sd_portfolio ~ "red",
           returns > mean_portfolio + sd_portfolio ~ "green",
           T ~ "darkblue"
         ),
         color= factor(color, levels = c("green","darkblue","red")))


portfolio_plot_optimized = portfolio_return_opmitized %>% 
  to.monthly(OHLC=F,indexAt = "lastof") %>%
  as.data.frame(row.names = index(.)) %>%
  rownames_to_column("date") %>%
  rename("returns"=portfolio.returns) %>%
  mutate(date = as.Date(date),
         color = case_when(
           returns < mean_portfolio_optimized - sd_portfolio_optimized ~ "red",
           returns > mean_portfolio_optimized + sd_portfolio_optimized ~ "green",
           T ~ "darkblue"
         ),
         color= factor(color, levels = c("green","darkblue","red")))


```

# RESUMO

Contexto: O mercado de criptomoeda tem se maturado como uma forte alternativa ao mercado de ações convencionais, transformando assim novos modelos de negócios e formas de realizar transações.

Lacuna: No entanto, por ser algo recente ainda há poucos estudos utilizando a moderna teoria de portfólio de Markowitz aplicado a este setor.

Proposta: Devido à alta instabilidade deste mercado, o corrente estudo tem por desejo em verificar a aplicação da moderna teoria de portfólio de Markowitz sobre ele.

Metodologia: Por isso essa pesquisa se caracteriza como uma pesquisa exploratória-quantitativa que usará como abordagem de revisão bibliográfica e análise de documentos.

ResultadoS:

# INTRODUÇÃO {#sec-introducao}

## PROBLEMA DE PESQUISA {#sec-problemaPesquisa}

Analisar se a volatilidade do mercado de criptomoedas afeta diretamente na utilização da moderna teoria de portfólio.

## OBJETIVOS {#sec-objetivos}

### GERAL {#sec-objetivos-Geral}

Verificar a aplicação da moderna teoria de portfólio sobre o mercado de criptmoedas.

### ESPECÍFICOS {#sec-objetivos-Especifico}

-   Conceituar criptmoedas como ativos financeiros.
-   Diferenciar o mercado criptoativo do mercado de renda variável.
-   Analisar os impactos das regulações desse setor no Brasil.
-   Comparar o resultado da utilização do método contra uma seleção de portifólio igualmente distribuído.

## METODOLOGIA {#sec-metodologia}

Esse trabalho teve por objetivo verificar a aplicabilidade da moderna teoria de portfólio de Markowitz no mercado de criptomoedas.

Portanto esta pesquisa se classifica como objetivo exploratória, com a abordagem quantitativa, possuindo natureza básica e utilizando o método dedutivo.

A revisão bibliográfica foi realizada sobre uma seleção de artigos disponíveis nas plataformas: Periódicos CAPES, Scopus e Google Acadêmico. No qual atenderam aos seguintes critérios de busca: Markowitz, Portfolio Optimization, Optimização de portfólio, Cryptocurrency, Criptomoeda, Currency, Moeda, Regulation, Regulação, Scams, Golpes. os idiomas de pesquisa foram limitados a Português e Inglês. Também foi limitado as pesquisas entre o período de 2018 até 2023.

Foram utilizados como fonte para a realização dos códigos em R, o livro [@regenstein2018] e o site [Codingfinance, @portfoli2018].

Para realizar os cálculos foi utilizado a linguagem de programação R e os seguintes pacotes: **corrplot** [@wei2021], **knitr** [@xie2014], **openxlsx** [@schauberger2023], **PerformanceAnalytics** [@peterson2020], **quantmod** [@ryan2022], **rbcb** [@freitas2022], **RColorBrewer** [@neuwirth2022], **scales** [@wickham2022] e **tidyverse** [@wickham2019].

É ilustrado a utilização em cada um dos pacotes mencionados no seguinte diagrama que foi feito através do pacote **mermaid** [@mermaid]

```{mermaid}
%%| fig-width: 5.75
%%| fig-height: 5

flowchart TD
 a([Obtenção de dados]) ---|Selic| b[rbcb] 
 a ---|criptomoedas | c[quantmod] 
 b & c --> d[Transformação]
 d --> e[tidyverse] & f[base] & g[PerformanceAnalytics]
 e & f & g --> h{Resultado}
 h --> i[Grafico] & j[Tabela]
 i --> k[tidyverse] & l[corrplot] & m[RColorBrewer]
 j --> n[tidyverse] & o[knitr]
  
```

Os cálculos para a realização dos retornos mensais, retornos do portfólio e do índice Sharpe foram feitos através das seguintes funções *Return.calculate*, *Return.portfolio* e *SharpeRatio*. Estas funções pertencem ao pacote **PerformanceAnalytics**.

Para realizar os cálculos das matrizes de covariância, correlação e a expectativa de retorno média foram utilizadas as funções *cov*, *cor* e *mean* do pacote **Base**.

Para realizar a criação dos gráficos foi utilizado um conjunto de funções do pacote tidyverse sendo eles: *ggplot*, *geom_point*, *theme_classic*, *scale_y_continuous*, *scale_x_continuous* e *labs*.

O pacote do tidyverse também foi utilizado para realizar a transformação da tabela de um formato largo para o formato longo através da função *pivot_longer*. Também foi utilizado as funções *as.data.frame* e *rownames_to_column* para converter de um formato xts de arquivo para um formato tidy.

Para a realização do gráfico de covariância foi utilizado a função *corrplot* do pacote **corrplot** e a função *brewer.pal* foi utilizado para a seleção da paleta de cores do gráfico, no qual pertence ao pacote **RColorBrewer**.

Para realizar as diversas combinações de pesos possíveis ao portfólio, foi usado as funções *expand.grid*, *do.call*, *rep*, *list*, *rowSums*, *which*, *seq*, *length* e *setNames* do pacote **Base** e *as_tibble* e *reduce* do pacote **tidyverse**.

Foi variada por `r by`, ou seja `r toPercent(by)`, os pesos em cada combinação ao respeitar que a somatória de todos os pesos da carteira deva ser igual a 1, no qual 1 é igual a 100%, gerando assim um total de `r format(nrow(possibilities),big.mark=".",decimal.mark=",")` possíveis combinações com `r Nsymbols` ativos na carteira.

Para iterar sobre cada um dos pesos foi utilizado o FOR que é uma função de looping até que determinada condição seja satisfeita.

Para a seleção das criptomoedas foi utilizado o critério das 10 maiores criptomoedas em relação a capitalização de mercado segundo a plataforma *coinmarketcap* [@preços]. foi removido o USDT-USD e USDC-USD devido a elas funcionarem como uma moeda digital fiduciária, no qual é pareado o seu valor 1:1 com o dólar. Dessa forma a carteira foi composta de `r Nsymbols` criptomoedas.

Os ativos selecionados foram: `r textList(Fsymbols)`. No qual os seus símbolos são representados em pares com o a moeda estável USD, sendo eles: `r textList(symbols)`.

Os dados foram obtidos através da plataforma Yahoo Finance utilizando a função *getSymbols* do pacote **quantmod**, no qual o período analisado foi de `r dataInicio` até `r dataFim`. É importante destacar que devido a criptomoeda da Solana só ter seus dados disponíveis a partir de 11/04/2020, a análise para a composição do portfólio foi realizada a partir dessa data em diante.

A taxa livre de risco foi utilizada com base na taxa Selic utilizando a estrutura de [@ramalho2020] no qual transforma a taxa Selic anual média para mensal através da equação de conversão de juros anual para mensal. Nesse trabalho ao invés de converter para a taxa mensal será convertido pra diária pois será trabalhado com dados diários das criptomoedas.

Os dados da taxa Selic foram obtidos através da função get_series do pacote rbcb no qual realiza consultas na API do banco central, sendo os dados coletados da taxa Selic do mesmo período analisado das criptomoedas, 01/01/2020 até 01/01/2023, sendo a taxa Selic anual média de `r toPercent(selicAnualMedia)` e a taxa Selic diária média `r toPercent(rfr)`.

## REVISÃO SOBRE AS CRIPTOMOEDAS UTILIZADAS

Foram utilizadas nesse trabalho `r Nsymbols` criptomoedas, esta seção traz uma breve revisão sobre elas. Sendo elas: `r Fsymbols`.

O Bitcoin foi criada em 2008 com característica de ser uma moeda descentralizada no qual permite transações entre as partes sem intermediários e não possui alguma entidade a controlando, porém há contribuições continuas de diversos programadores para a continua evolução e melhoramento da rede [@bitcoin].

O Ethereum assim como o Bitcoin, também é uma criptomoeda descentralizada e funciona como um meio para que as outras criptomoedas possam operar em sua rede, tendo como destaque a elaboração dos smart contracts. Ela teve seu whitepape publicado em 2013, porém só foi fundada em 2014 por oito confundadores, dentre eles o Vitalik Buterin é o mais conhecido, a sua sede fica na cidade de Zug sendo localizada na Suiça. Tendo como seus principais objetivos ser uma plataforma universal para outras criptomoedas executem seus softwares nela [@ethereum].

O Binance é um token da Binance que por sua vez é uma exchange, ela oferece desconto em taxas aos seus detentores e direito de participação em lançamentos de tokens dentro de sua plataforma, sendo ele lançado em 2017 através de uma ICO [@bnb].

O XRP é uma moeda nativa da plataforma da Ripple foi criada em 2012 pela empresa Ripple Labs Inc seu intuito é ser um sistema de pagamento global, sendo, uma as suas principais vantagens, o custo baixo ao enviar dinheiro por sua rede [@xrp].

O Cardano foi lançada em 2017 sendo ela utilizada por empresas agrícolas no rasteiro dos seus produtos. Tendo como característica a participação democrática dos detentores de sua moeda sobre as mudanças projetadas na rede por sua equipe [@cardano].

O Dogecoin é uma moeda meme de uma raça de cachorro Shiba Inu no qual foi criada em 2013, sendo um dos seus fundadores o Billy Markus porém só foi lançada em 2014. Ela é usada principalmente como um sistema de gorjeta no fórum do Reddit e é usada com o intuito especulativo já que ela é amplamente influenciada pelas redes sociais [@dogecoin].

A Solana foi criada com o intuito de facilitar a elaboração de D'app que também são conhecidos como aplicativos descentralizados. Ela foi criada em 2020 pela empresa Solana Foundation ela tem sua sede em Genebra que fica localizada na suíça. Ela apresenta uma inovação no sistema ao introduzir o sistema de proof of history no qual permite maior usabilidade no protocolo [@solana].

A Matic é uma criptomoeda da Polygon que funciona como meio para transações dentro da sua rede, tendo como funcionalidades: a possibilidade da participação das decisões adotadas dentro do projeto, funcionar como um meio de pagamento e staking que é uma forma de obter renda passiva com o ativo. Sendo a polygon uma plataforma que busca por facilitar a conexão entre redes compatíveis com a ethereum e reduzir problemas nesse processo. Sendo criada em 2017 por Jaynti Kanani, Sandeep Nailwal e Anurag Arjun [@polygon]

# REVISÂO DE LITERATURA {#sec-desenvolvimento}

## CRIPTOMOEDA

As criptomoedas são observadas por diversos grupos da sociedade ao redor do mundo, sendo eles: investidores, financeiras, organizações governamentais, bancos centrais, legisladores, economistas, pesquisadores e etc. umas das explicações possíveis a esse fenômeno se dá ao fato do alto nível de liquidez como resultado de uma flexibilização monetária e pequenos rendimentos de ativos financeiros.[@arzova2021].

O seu termo surgiu com o advento da inovação tecnológica desenvolvida pelo pseudônimo Satoshi Nakamoto ao criar o Bitcoin com o intuito de ser um meio de troca. Diferente das moedas fiduciárias, a criptomoeda não se baseia na figura de uma autoridade central, mas sim na criptografia pra controlar e administrar [@kliber2019].

Com a criação do Bitcoin, foi concretizado os desejos de grupos anarquistas, no qual via o instrumento da criptografia como uma alternativa viável contra o controle e supervisão estatal por volta dos anos 1980 e 1990 [@mattos2020].

De tal forma as criptomoedas possuem a características de ser uma moeda descentralizada que operam sob a blockchain. Elas são operadas de forma de pessoa para pessoa sem a interferência de terceiras partes envolvidas, no qual a validação de cada transação é feita por computadores conectados à rede [@mattos2020].

O conceito de blockchain para o mercado de criptomoedas, é como um livro-razão onde se registra dados das transações. No qual só pode ser adicionado o novo dado ao final deste livro [@kolb2021].

Novos blocos são adicionados por certos nós na rede e vinculados criptograficamente a blocos de dados anteriores, o que torna a blockchain inviolável e acessível a todos na rede [@schellinger2020].

Para que um nó valide determinado bloco na blockchain é feito um trabalho denominado de mineração [ULRICH, 2014 apud @aragon2018].

O conceito de mineração consiste em um processo no qual computadores conectados à rede tentam solucionar os cálculos matemáticos [ULRICH, 2014 apud @aragon2018].

O processo de mineração criptomoeda se tornou uma forma de renda acessível onde há uma alta inflação e falta de confiança nos governos locais [@kliber2019].

Um exemplo é o caso da Venezuela, pois em um período, a eletricidade era subsidiada então não havia custos de energia para o indivíduo. No entanto em 2016 o presidente Maduro anunciou a proibição de mineração de Bitcoin e outras criptomoedas, em 2018 foi declarado legal novamente devido a vontade do governo de lançar a sua própria criptomoeda nacional. (Kliber et al. 2019) Além disso as criptomoedas possibilitaram uma nova forma de arrecadar fundos para pequenas startups através da ICO (Initial Coin Ofering, oferta inicial da moeda) [@xu2021].

No qual o conceito de ICO é compreendido como uma forma descentralizada de fundo colaborativo no qual é empregado sobre a rede da blockchain, para arrecadação através da emissão de tokens. De tal maneira possui a característica do rápido método de financiamento e um limite baixo [@xu2021].

Por outro lado, o mercado de criptomoedas possui riscos como por exemplo a assimetria da informação entre os mercados, seja elas causadas por problemas de softwares (Bugs, hacks e etc) [@benedetti2021].

Além disso, o mercado de criptomoedas é sujeito a diversos tipos de golpes, no qual é categorizado entre sete tipos de golpes principais: esquemas ponzi, malware, falsos serviços criptos, golpes de taxas avançadas, e-mail negro, falsa ICO e lavagem de dinheiro [@bartoletti2021].

O esquema ponzi é um golpe que promete pagar altos retornos sobre o montante investido. No qual estes retornos são pagos por novos participantes do esquema [@kerr2023].

O vírus Malware é categorizado entre dois tipos principais de vírus: Ransomware e Crypto loggers. No qual os desenvolvedores de vírus exploram a propriedade da não rastreabilidade das criptomoedas [@bartoletti2021].

O vírus ransoware é uma violação dos aparelhos tecnológicos no qual bloqueiam o acesso a eles, até que determinado pagamento seja feito [MUSIALA, 2020 apud @trozze2022].

Já no caso do vírus Crypto loggers, ele é mais sutil ao ser uma interface transparente que tenta descobrir a chave secreta da carteira da vítima e assim realizar pagamentos da conta dele para a do golpista [@bartoletti2021].

Os falsos serviços criptos são golpes em que criminosos desenvolveram serviços se passando como aplicações reais, alguns exemplos são: falsa corretora, falsa carteira, falso mix, falso piscina de mineração e falsa doações [@bartoletti2021].

As falsas corretoras se referem a golpes em que as vítimas são convencidas a comprar criptomoedas diretamente através dessas falsas corretoras, após a compra fecham as falsas corretoras e somem com o dinheiro [@kerr2023].

As falsas carteiras são serviços que fornecem o armazenamento de criptomoedas no qual assim que as vítimas enviam suas criptomoedas, os criminosos transferem todos ou parcialmente o dinheiro existente da carteira da vítima [@kerr2023].

Os falsos serviços mixing são serviços que permitem, ao randomizar o número de transações e utilizar algum endereço externo, apagar os links entre endereços iniciais e finais nos movimentos da blockchain. Porém eles recebem o dinheiro e não reenviam ao cliente [@bartoletti2021].

As falsas piscinas de mineração são compreendidas como operações no qual, o criminoso, induzem as vítimas a investir em projetos que tem por intenção a operação de mineração e com isso promete altos retornos, porém essas vítimas não são pagas [@kerr2023].

Já nas Falsa doações são criadas campanhas de doações falsas prometendo ajudar em algum projeto ou pessoa, porém eles somem com o dinheiro [@bartoletti2021].

Os golpes de taxas avançadas são práticas que tentam convencer a vítima a enviar criptomoedas a um endereço particular com promessas de retorno maior [Phillips & Wilder, 2020 apud @trozze2022].

Os E-mails negros são um tipo de golpe em que e-mails são enviados as vítimas em que o golpista alega ter hackeado e a gravado através da webcam. Dessa forma ele solicita pagamento de resgate para não publicar em redes sociais e deletar o material coletado [@bartoletti2021].

As falsas ICOs' se caracterizam com alguma característica particular que as demais não possuem, por exemplo como o apoio de uma celebridade ou um time falso de trabalho, induzindo assim ao comprador adquirir participação no falso projeto [@bartoletti2021].

A lavagem de dinheiro é caracterizada como dinheiro provindo de origem ilícita que para ser usado como dinheiro legal é feito um disfarce sobre sua origem. [@silveira2020]

De tal forma é possível notar duas diferenças principais entre o mercado de renda variável com o de criptomoedas, sendo elas: o ambiente regulatório e a característica tecnológica aplicada [@benedetti2021].

A falta de regulação aplicadas ao mercado de criptomoedas acaba por não garantir a integridade desse mercado e a sua transparência sendo este o fator distintivo entre o mercado de renda variável, porém já é possível notar um desenvolvimento nesse sentido com a adesão dos procedimentos anti lavagem de dinheiro (AML), conheça seu cliente (KYC) e requerimento de reserva [@benedetti2021].

Em relação a tecnologia, o mercado de criptomoedas é marcado pela custodia descentralizada, ou seja, o mercado assume a custodia do token no qual o usuário transfere de sua carteira para o mercado [@benedetti2021].

Já para o mercado de renda variável é o oposto, a custodia é centralizada no qual as operações sobre ele são feitas através de intermediários enquanto no mercado criptoativo as operações são feitas diretamente entre as partes [@benedetti2021].

No entanto há divergência de classificação acerca das criptomoedas [Bouri, 2017 apud @kliber2019].

Para Chuen (2015) devido as criptomoedas serem sujeitas a oscilações diárias em seu valor e serem negociadas através de corretoras especializadas, faz com que elas se caracterizem mais como um ativo financeiro [apud @mattos2020].

De acordo com [@fry2023] as criptomoedas se assemelham no geral como uma classe de ativo financeiro tecnológica, sendo a exceção o Bitcoin e a Solana no qual tem características de moeda.

Já para [@ozdurak2022] elas podem ser classificadas em diversos grupos como instrumentos financeiros, valores mobiliários, commodities ou instrumento de pagamento.

Portanto devido a possibilidade da caracterização da criptomoeda como uma moeda fiduciária, se faz necessário uma análise sobre o conceito do papel que elas exercem e sua classificação do ponto de vista jurídico.

## MOEDA

O conceito de moeda é caracterizado como uma criação do estado com a finalidade de ser um meio de pagamento para obrigações fiscais [KNAPP. 2023 apud @bernardo2019].

Ou seja, a moeda é um reconhecimento de dívida. No qual a transformação em dinheiro é realizada através do poder do estado de declarar que é passível de quitação de outras dividas [@mattos2020].

Para que seja considerado uma moeda, ela deve exercer três funções elementares sendo estas: meio de troca, unidade de conta e reserva de valor [NUNES, 2016 apud @aragon2018].

A função meio de troca é o que possibilita a realização de compra e venda entre bens e serviços, a função unidade de conta é o que permite uma padronização monetária para que as mercadorias e os insumos sejam quantificados em dinheiro e a função reserva de valor resguardar o valor do dinheiro utilizado para que em momento posterior possa ser usado como meio de troca [@estellita2020].

Além dessas três funções clássicas da moeda, ela deve conter as seguintes características: divisibilidade, durabilidade, alta complexibilidade para falsificação, manuseabilidade e transportabilidade [@breunig2020].

No caso especifico do Bitcoin, ele tem as propriedades da divisibilidade e portabilidade possuindo assim características de ser um meio de pagamento descentralizado [ARAÚJO; SILVA, 2017 apud @junior2021].

Para Woodford (2011) As criptomoedas com características semelhantes ao Bitcoin possuem as funções reservas de valor, meio de troca, mas não a da unidade de conta pois a falta de uma ampla aceitação da sociedade para utilizarem ao realizar trocas entre si [apud @white2020].

Já para [@breunig2020] o Bitcoin não deva ser categorizado como uma moeda fiduciária devido não possuir a função reserva de valor pois possui a alta variação no seu preço.

Sendo confirmado esse pensamento também por [@aragon2018] ao relacionar a alta volatilidade do Bitcoin com o principal fator impeditivo de classifica-la como moeda e assim a afastando de seu proposito originário.

## REGULAÇÃO

Para o âmbito jurídico a moeda deve possuir o cursor legal que é classificado quando as pessoas de uma determinada sociedade tem por obrigação aceitar a moeda, o cursor forçado quando não é permitido pedir reembolso em forma de outros ativos e o poder liberatório quando é meio jurídico valido para quitar dívidas e obrigações contraídas [@castello2019].

Segundo Telles (2020, p. 59) as criptomoedas não possuem nenhum desses atributos [apud @morais2022].

Para Silveira (2020, p. 30/31) há a possibilidade delas possuírem o poder libertário [apud @morais2022].

No geral as criptomoedas tem diversas classificações acerca de como deva ser compreendida ao redor do mundo, enquanto alguns países baniram o direito de da comercialização e da circulação da moeda como é o caso de Nepal, porém em sua grande maioria é liberado, na Itália e Japão é exigido o registro e a licença da operação da criptomoeda e no México é aceito como meio de pagamento [@shirakawa2019].

O Brasil atualmente se integra um grupo seleto de países que possuem regulamentação para as criptomoedas por intermédio da Lei 14.478/2022, no qual conceitua as criptomoedas como os ativos virtuais, os classificando como representação de valor que pode ser negociada, utilizada como meio de pagamento ou com propósitos de investimentos, fazendo a desassociação entre o Bitcoin como moeda fiduciária [@neto2023].

A lei também procura regular as corretoras, pois elas só poderão atuar em território brasileiro mediante autorização dos órgãos da administração pública, além disso também ficou permitido ao Banco Central acumular ou prestar serviço de ativos virtuais [@neto2023].

Segundo Vaz de Almeida (2023) com a criação da lei ficou estabelecido um dispositivo no qual prever a criação de um novo código penal especifico aplicado a fraudes envolvendo criptomoedas [apud @fontgalland2023].

A classificação de prestadoras de serviço de criptmoedas passou a ser semelhante a de instituições financeiras, também foi estabelecido que tais agentes se enquadravam no rol do artigo 9 da lei 9.613 aplicados a lavagem de dinheiro e no código de defesa do consumidor ao conduzir operações no mercado de criptmoedas [@fontgalland2023].

## MARKOWITZ

Markowitz nasceu em 1927 em Chicago, Estados Unidos [@nobelPrize].

Ele publicou sua teoria em 1952, intitulada seleção de portfólio, no qual posteriormente passou a ser conhecida como moderna teoria de portfólio [@Globo].

Foi um dos pioneiros ao realizar estudos verificando os benefícios da diversificação da carteira [@Globo].

Em 1990 recebeu o prêmio Nobel de economia pela teoria que revolucionou a forma de construir uma carteira de investimento [@Suno].

Ele faleceu no dia 26 de junho de 2023 [@Suno].

A iniciativa de investimento é uma tentativa de segurança contra qualquer ameaça que possa enfrentar, sendo a alocação de dinheiro para benefício no futuro um traço comum humano [@ma2020].

A moderna teoria de portfólio desenvolvida por Harry Markowitz se baseia na abordagem da construção de portfólio com o intuito de maximizar o retorno esperado a um menor risco [@abubakar2019].

O risco dos ativos são calculados através da formula de desvio padrão [@abubakar2019].

A diversificação do portfólio tem por intenção suavizar os riscos não sistêmicos em um portfólio, no qual se baseia em que se um ativo tiver uma performance ruim, logo os outros ativos da sua cesta neutralizarão o desempenho negativo, dado que a correlação entre eles seja negativa, sendo considerado assim um ativo de porto seguro para enfrentar os períodos de turbulências no mercado [@kliber2019].

A correlação é uma medida de como os ativos se movem juntos, ou seja, é um coeficiente que indica a forma como os ativos podem ser usados para um portfólio com o intuito de diversificação [@ram2018].

O risco pode ser reduzido com a introdução de ativos negativamente correlacionados ao portfólio [@abubakar2019].

Para tal há cinco premissas que permeiam sobre a teoria de Markowitz sendo elas: que o investidor considera as alternativas de investimento pela probabilidade do retorno esperado, a maximização da utilidade esperada e a sua curva marginal da riqueza decrescente, que os riscos são estimados pela variabilidade do retorno esperado, a sua decisão é fundada na premissa de risco e retorno e por fim os investidores preferirão ativos com menos risco ao invés do mais arriscados e que também irão preferir maiores retornos ao invés de retornos menores [@abubakar2019].

No geral, a aplicação da moderna teoria de portfólio é mal compreendida. A diversificação não é garantia por um alto retorno comparado ao retorno mercado que se tem por referência, a proposta principal não é apenas manter uma cesta diversificada de ativos, mas também considerar a relação entre os ativos individuais da sua carteira [@ozdurak2022].

Ou seja, não é sobre o risco individual de cada ativo, e sim sobre como todos os demais se performam como um portfólio [@ozdurak2022].

Além disso aumenta a adoção mundial de criptomoedas junto com outras moedas estáveis, enquanto governos como china e índia proibiram o comercio. Dessa forma o risco maior é de curto prazo dado a falta de regulação e previsibilidade sobre esses novos ativos, além do mais as criptomoedas tem por sua característica o alto retorno e risco comparadas com ativos [@ozdurak2022].

O perfil de risco premia ao nível de risco assumido, isso pode ser medido usando a razão de Sharpe no qual demonstra os retornos por unidade de risco aceitado [@ram2018].

O Indice de Sharpe é uma ferramenta que auxilia na comparação de performance entre ativos agrupados no portfólio, ao se calcular os retornos excessivos sobre a taxa livre de risco, sendo a Razão Sharpe maior que um aceitável e consequentemente quanto maior for ela mais retornos excessivos sobre a taxa livre de risco, que em sua finalidade é capaz de fornecer a fronteira eficientes entre diferentes portfólios [@ma2020].

A fronteira eficiente pode ser compreendida como uma linha no qual possui os melhores retornos ao niveis de risco assumidos sobre um conjunto de combinações possiveis na composição do portfólio, para tal ela utiliza o indice sharpe como parametro [@silva2019].

Em um estudo realizado por Brauneis and Mestel (2019) sobre os benefícios da inclusão das criptomoedas no portfólio utilizando a estrutura de markowtiz, constataram que elas reduziam o risco do portfólio [apud @ozdurak2022].

# FORMULAS MATEMATICAS

A formula para calcular o retorno utilizada foi: 

$$
R_{x,t} = log(P_{t}) - log(P_{t-1})
$$
Onde $R_{x,t}$ = Retorno do ativo x no período e P = Preço do ativo no período t

A formula para calcular o risco utilizada foi:

$$
\sigma_{x} = \frac{\sum^{n}_{i=1}(x_{i}-\overline{x})^2}{n-1}
$$
Onde $\sigma_{x}$ = desvio padrão de x, n = é o numero pontos, $x_{i}$ = os dados de cada valor e $\overline{x}$ = é a media da variavel x

A formula para calcular a correlação foi:

$$
P_{x,y} = \frac{COV_{x,y}}{\sigma_{x}\sigma_{y}}
$$

Onde $cov_{x,y}$ = covariância de x e y, $\sigma_{x}$ = desvio padrão de x e $\sigma_{y}$ = desvio padrão de y

A formula para calcular o retorno do portfólio foi:

$$
R_{p} = \sum^{N}_{t=1} x_{t}w_{t}
$$
Onde $R_{p}$ = Retorno do portfólio, N = quantidade da dados, t = Período, $x_{t}$ = Ativo no período e $w_{t}$ = peso do ativo no período. 


A formula para calcular a razão sharpe foi:

$$
sr = \frac{R_{p} - R_{f}}{\sigma}
$$
Onde sr = razão sharpe, $R_{p}$ = retorno do portfólio, $R_{f}$ = taxa livre de risco e $\sigma$ = desvio padrão

A formula para realizar a conversão da taxa de juros anual para diária utilizada foi:

$$
i_{a.d} = (1+\overline{i_{a.a}})^\frac{1}{252}-1
$$
Onde $i_{a.d}$ = taxa de juros diária e $\overline{i_{a.a}}$ = taxa de juros média anual 

# RESULTADOS {#sec-Resultados}

A relação de risco e retorno esperado entre os ativos da carteira é demonstrada no @fig-RiscoxRetorno, sendo o `r less_riskier$asset` o ativo de menor risco com um desvio padrão de `r toPercent(less_riskier$sd)` e retorno esperado de `r less_riskier$mean`. Enquanto `r more_proftible$asset` é o ativo de maior retorno esperado com o desvio padrão de `r toPercent(more_proftible$sd)` e retorno esperado de `r more_proftible$mean`.

```{R}
#| label: fig-RiscoxRetorno
#| fig-cap: Risco x Retorno
#| fig-width: !expr figWidth
#| fig-height: !expr figHeight


asset_return_long %>%
  group_by(asset) %>%
  summarise(sd= sd(returns), mean= mean(returns)) %>%
  add_row(asset="PORTFOLIO NORMAL", sd = sd_portfolio, mean=mean_portfolio ) %>%
  add_row(asset="PORTFOLIO OPTMIZADO", sd = sd_portfolio_optimized, mean=mean_portfolio_optimized ) %>%
  ggplot(aes(x=sd,y=mean,color=asset)) +
  geom_point(size=2, show.legend = FALSE) + 
  scale_x_continuous(labels = scales::percent) +
  labs(y="Retorno esperado",
       x="Risco",
       colour="Ativo") +
  geom_text(aes(label = asset, y = mean + .0002),size=2) +
  theme_bw() +
  theme(legend.position="none", plot.title = element_text(hjust = .5))
```

Em seguida foi verificado a matriz de correlação dos ativos e verificado que os ativos são positvamente correlacionados, veja em @tbl-correlacao e no gráfico @fig-correlacao.

```{R}
#| label: tbl-correlacao
#| tbl-cap: "Matriz de correlação"

correlation2 = correlation_cryptocurrency %>% 
  as.data.frame() %>% 
  rownames_to_column("ATIVO")

kable(correlation2,
      format = "simple",
      digits = 3,
      format.args = list(scientific=FALSE,big.mark = ".",decimal.mark=","))


```

```{R}
#| label: fig-correlacao
#| fig-cap: gráfico de correlação
#| fig-width: !expr figWidth
#| fig-height: !expr figHeight

corrplot(correlation_cryptocurrency, 
         #type="upper", 
         method = "ellipse",
         col=brewer.pal(n=length(symbols), name="RdYlBu"),
         tl.col = "black"
         )
```

Ao performar as combinações dos ativos possíveis foram encontradas as 5 combinações com melhores índice Sharpe conforme demonstrado na @tbl-melhoresCombinacoes. Sendo o ponto de tangência do portfolio com a combinação de `r toPercent(as.numeric(summaryBestCombination))` dos ativos distribuidos em `r textList(names(summaryBestCombination))` respectivamente, sendo o índice Sharpe de `r round(bestCombination$sharpeRatePortfolio,4)`, desvio padrão de `r toPercent(bestCombination$sd)` e retorno esperado de `r bestCombination$mean`.

Já o ponto de menor variancia do portfólio é composto por `r toPercent(as.numeric(summarysafetyCombination))` do ativo composto de `r textList(names(summarysafetyCombination))` com um indice sharpe de `r round(safetyCombination$sharpeRatePortfolio,4)`, desvio padrão de `r toPercent(safetyCombination$sd)` e retorno esperado de `r safetyCombination$mean`.

```{R}
#| label: tbl-melhoresCombinacoes
#| tbl-cap: "top 5 melhores combinações com base no índice Sharpe"

slice_max(possibilities,sharpeRatePortfolio,n=5) %>% 
  mutate_at(vars(1:length(symbols)),~paste0(.x*100,"%")) %>%
  mutate(sharpeRatePortfolio = round(sharpeRatePortfolio,4),
         sd = paste0(round(sd * 100,4),"%") ) %>%
  #mutate_at(vars(c("sharpeRatePortfolio","sd")), ~paste0(round(.x * 100,4),"%")) %>%
  rename(`Indice Sharpe` = sharpeRatePortfolio,
  Risco=sd,
  `Retorno esperado`= mean) %>%
  kable(format = "simple") 

# possibilities %>% 
#   arrange(desc(sharpeRatePortfolio)) %>% 
#   head() %>% 
#   gt() %>% 
#   fmt_percent(columns = symbols,decimals = 0, dec_mark = ",", sep_mark = ".") %>%
#   fmt_percent(columns = c(sharpeRatePortfolio,sd),decimals = 3, dec_mark = ",", sep_mark = "." ) %>%
#   cols_label(sharpeRatePortfolio = "Indice Sharpe", sd= "Risco", mean = "Retorno esperado")



```

Ao realizar todas as `r format(nrow(possibilities),big.mark=".",decimal.mark=",")` combinações de carteira possiveis, foi traçado o gráfico de optimização de portfólio e fronteira eficiente no qual foi destacado as siglas M.V significando o ponto de menor variância e a sigla P.T se referindo ao Ponto de Tangência, veja em @fig-fronteiraEficiente.

```{R}
#| label: fig-fronteiraEficiente
#| fig-cap: Optimização de portfolio & Fronteira eficiente
#| fig-width: !expr figWidth
#| fig-height: !expr figHeight


possibilities %>%
  ggplot(aes(x = sd, y = mean, color = sharpeRatePortfolio)) +
  geom_point() +
  theme_classic() +
  scale_y_continuous(labels = scales::percent) +
  scale_x_continuous(labels = scales::percent) +
  labs(x = 'Risco',
       y = 'Retorno esperado',
       colour = "Indice sharpe") +
  geom_point(aes(x = sd,
                 y = mean), data = min_var, color = 'red') +
  geom_point(aes(x = sd,
                 y = mean), data = max_sr, color = 'red') +
  geom_text(x=min_var$sd, y = min_var$mean - .0002,label="M.V", color = "red",size=3,check_overlap = T) +
  geom_text(x=max_sr$sd, y = max_sr$mean + .0002,label="P.T", color = "red",size=3, check_overlap = T) +
  theme_bw() +
  theme( plot.title = element_text(hjust = .5))



```

Por fim foi comparado o retorno do portfólio com pesos igualmente dsitribuidos, classificado como portfólio normal veja na @fig-retornoPortfolioNormal, com o retorno do portfólio optimizado segundo o ponto de tangência da fronteira eficiente, veja na @fig-retornoPortfolioOptmiziado.

Os resultados obtidos foram que para o portfólio normal o desvio padrão é igual a `r sd(portfolio_return$portfolio.returns)` e retorno esperado de `r mean(portfolio_return$portfolio.returns)` enquanto pro portfólio optmizado o desvio padrão é de `r sd(portfolio_return_opmitized$portfolio.returns)` e o retorno esperado de `r mean(portfolio_return_opmitized$portfolio.returns)` ou seja a optimização do portfólio o tornou em um portfólio mais arriscado com maior retorno.

```{R}
#| label: fig-retornoPortfolioNormal
#| fig-cap: Retorno do portfolio normal
#| fig-width: !expr figWidth
#| fig-height: !expr figHeight

portfolio_plot %>%
  ggplot(aes(x=date, y =returns,color=color)) +
  geom_point() +
  scale_color_manual(name="Legenda",
                     labels=c("1 Desvio padrão acima da media",
                              "esta entre um desvio padrão acima e abaixo da média",
                              "1 Desvio padrão abaixo da média"),
                     values = c("darkblue"="darkblue","green"="green","red"="red")) +
  scale_x_date(breaks = pretty_breaks(n = 3)) +
  scale_y_continuous(breaks = pretty_breaks(n = 5),limits = c(yMin,yMax)) +
  geom_hline(yintercept = (mean_portfolio + sd_portfolio),
             color = "black",
             linetype = "dashed") +
  geom_hline(yintercept = (mean_portfolio- sd_portfolio),
             color = "black",
             linetype = "dashed") +
  theme_bw() +
  labs(x="Data",y="Retornos") +
  theme(legend.text=element_text(size=6),
        legend.position = "bottom",
        legend.spacing.x = unit(0,"mm"),
        legend.direction = "horizontal",
        legend.title = element_blank())


```

```{r}
#| label: fig-retornoPortfolioOptmiziado
#| fig-cap: Retorno do portfolio optimizado
#| fig-width: !expr figWidth
#| fig-height: !expr figHeight

portfolio_plot_optimized %>%
  ggplot(aes(x=date, y =returns,color=color)) +
  geom_point() +
  scale_color_manual(name="Legenda",
                     labels=c("1 Desvio padrão acima da media",
                              "esta entre um desvio padrão acima e abaixo da média",
                              "1 Desvio padrão abaixo da média"),
                     values = c("darkblue"="darkblue","green"="green","red"="red")) +
  scale_x_date(breaks = pretty_breaks(n = 3)) +
  scale_y_continuous(breaks = pretty_breaks(n = 5),limits = c(yMin,yMax)) +
  geom_hline(yintercept = (mean_portfolio_optimized + sd_portfolio_optimized),
             color = "black",
             linetype = "dashed") +
  geom_hline(yintercept = (mean_portfolio_optimized- sd_portfolio_optimized),
             color = "black",
             linetype = "dashed") +
  theme_bw() +
  labs(x="Data",y="Retornos") +
  theme(legend.text=element_text(size=6),
        legend.position = "bottom",
        legend.spacing.x = unit(0,"mm") ,
        legend.direction = "horizontal",
        legend.title = element_blank())
```

De tal forma é possivel verificar que a aplicação da Moderna teoria de portfólio ao mercado de critpmoedas é valido, pois através do metodo conseguimos elevar o indice sharpe e encontrar o ponto de tangência do portfólio.

# CONCLUSÂO {#sec-Conclusão}

Ao longo deste estudo foi abordado o conceito de criptmoeda, seu funcionamento, os riscos e os benefícios que advem com a sua utilização.

Além disso foi exposto o conceito de moeda e porque as criptomoedas devam ser caracterizadas como um ativo financeiro tecnológico ao invês de uma moeda fiduciária, sendo, sobre o ponto de vista econômico, a sua natureza especulativa com alta volatidade de preços que afasta principalmente as criptomoedas da função reserva de valor.

Também foi avaliado sob o ponto de vista juridico e verificado a situação regulatória atual das criptomoedas no Brasil no qual é definido atualmente como um ativo financeiro.

Além do mais buscou compreender o conceito da moderna teoria de portfólio de markowitz e sua aplicação no mercado de criptmoedas.

Por fim foi analisado os resultados da moderna teoria de portfólio numa carteira composta exclusivamente de criptomoedas, no qual foi comparado um portfólio de criptomoedas igualmente distribuido com o portfólio optimizado. Sendo os resultados positivos sobre a sua aplicação ao determinar o ponto de tangência, menor variancia e traçar a fronteira eficiente do portfólio.

Ao realizar o estudo, foi encontrado a limitação temporal dos dados no qual a criptomoeda da Solana só há dados a partir de 11/04/2020, dessa forma para poder comparar o portfólio foram utilizadas somente os dados de 11/04/2020 em diante.

Outra limitação encontrada foi a memória computacional, no qual ao tentar verificar todas as combinações possíveis de carteira alterando em 0,05 da quantidade percentual alocado em determinados ativos, sendo que o somatório de todos os ativos seja igual a 1, excedeu a memória limite disposta no momento, sendo assim, afim de contornar tal problemática a variação em cada ativo passou pra 0,1.

A taxa livre de risco utilizada foi a taxa Selic diária média, no qual foi retirado uma média da taxa Selic anual de `r dataInicio` até `r`dataFim`que resultou em`r toPercent(selicAnualMedia)`e posteriormente convertido a taxa de juros diária que resultou em`r toPercent(rfr)\`.

foi possivel aprender também a realizar cálculos dos retornos do portfólio, índice Sharpe, curtose, distorções e gerar diversas combinações de carteiras a fim de encontrar a fronteira eficiente e ponto de tangência.

Também foi possível a compreensão do ponto de vista econômico quais características devem ser preenchidas pra que seja considerado uma moeda e da mesma forma do ponto de vista jurídico para tal assunto.

Além disso foi exposto alguns riscos de golpes envolvendo criptomoedas e suas aplicações tanto no âmbito digital quanto no âmbito real, porém não se limita a apenas ao demonstrado, tendo assim inúmeros outros existentes.

Da mesma, foi exposto os benefícios advindos de tais tecnologias e investimentos, como por exemplo uma fonte de renda extra através da prática da mineração e levantamento de fundo de investimento para startups e pequenas empresas através de ICO.

Destaca-se nesse estudo, o fato do Brasil ser uns dos poucos países a ter uma legislação própria sobre criptomoedas e a limitar as exchanges que operam sobre o território nacional, no qual são sujeitas a fiscalização. Sendo nesse ponto, valido verificar se com a presença dessa nova legislação impactara positivamente na adesão da população para utilização das criptomoedas como um investimento de curto, médio e longo prazo.

Além disso como pontos de aprofundamento sobre o atual método empregado, seria interessante a alocação de um ou mais ativos negativamente correlacionado na carteira a fim de verificar a performance do portfólio.

Por fim vale a pena destacar também que devido a sua natureza especulativa fosse interessante uma análise das finanças comportamentais.

Ao analisar os objetivos traçados na pesquisa foi possivel obter os seguintes resultados em cada um deles:

objetivo geral satisfeito ao conseguir aplicar a metodologia de portfólio de markowitz no mercado de criptomoedas.

Já nos objetivos especificos, que compreendiam: Conceituar criptmoedas como ativos financeiro, Diferenciar o mercado criptoativo do mercado de renda variável, Analisar os impactos das regulações desse setor no Brasil e Comparar o resultado da utilização do método contra uma seleção de portifólio igualmente distribuído.

O objetivo específico conceituar criptmoedas como ativos financeiros foi satisfeito ao realizar a revisão de literatura.

O objetivo específico diferenciar o mercado criptoativo do mercado de renda variável foi satifesito ao verificar sobre os pontos regulatorios e tecnologicos que ambos diferem.

O objetivo específico Analisar os impactos das regulações desse setor no Brasil foi satisfeito ao verificar que com a criação da lei 14.478/2022 ficou definido a classificação de criptmoeda, a equiparação das empresas prestadoras de serviços de criptmoedas com instituições financeiras e elas estariam sujeitas, ao conduzir operações relacionadas a aos ativos digitais, ao codigo de defesa do consumidor.

O objetivo específico comparar o resultado da utilização do método contra uma seleção de portifólio igualmente distribuído foi satisfeito resultando na melhora de perfomance do portfólio.

{{< pagebreak >}}

# BIBLIOGRAFIA {#sec-Bibliografia}
